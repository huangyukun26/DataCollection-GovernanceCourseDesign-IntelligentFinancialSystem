{% extends "base.html" %}

{% block title %}发票列表{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">发票列表</h5>
        <a href="/invoices/upload" class="btn btn-primary">上传新发票</a>
    </div>
    <div class="card-body">
        <table class="table">
            <thead>
                <tr>
                    <th>发票号码</th>
                    <th>发票代码</th>
                    <th>销售方</th>
                    <th>购买方</th>
                    <th>金额</th>
                    <th>开票日期</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody id="invoiceList">
                <!-- 发票列表将通过JavaScript动态加载 -->
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function formatMoney(amount) {
    return new Intl.NumberFormat('zh-CN', {
        style: 'currency',
        currency: 'CNY'
    }).format(amount);
}

async function loadInvoices() {
    try {
        const response = await fetch('/api/invoices/');
        const invoices = await response.json();
        
        const tbody = document.getElementById('invoiceList');
        tbody.innerHTML = invoices.map(invoice => `
            <tr>
                <td>${invoice.invoice_number}</td>
                <td>${invoice.invoice_code}</td>
                <td>${invoice.seller}</td>
                <td>${invoice.buyer}</td>
                <td>${formatMoney(invoice.amount)}</td>
                <td>${invoice.invoice_date}</td>
                <td>
                    <a href="/invoices/${invoice.id}" class="btn btn-sm btn-info">查看</a>
                </td>
            </tr>
        `).join('');
    } catch (error) {
        alert('加载发票列表失败：' + error.message);
    }
}

// 页面加载时获取发票列表
document.addEventListener('DOMContentLoaded', loadInvoices);
</script>
{% endblock %} 